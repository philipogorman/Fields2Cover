# Special Variables:
# ${DESTDIR} <-- Build Root Directory
# ${OSARCH} <-- Target Arch [arm-linux-gnueabihf,x86_64-linux-gnu]
# ${arch_opt} <-- Target Arch [i386,armhf,amd64,arm64]
# arch_opt is used for selecting builds, and the target directories:
#   are usually /usr/lib/${OSARCH}/

#Setup the repository directories / structure
PRE_MAKE_BUILD_ROOT: []
MAKE_BUILD_ROOT:
#- mkdir -p $DESTDIR/usr/share/doc/${PACKAGE_NAME}/
  - mkdir -p $DESTDIR/usr/lib
  - mkdir -p $DESTDIR/usr/include/jca-fields2cover

POST_MAKE_BUILD_ROOT: []

#Place the files inside the repository
PRE_BUILD_REPO: []
BUILD_REPO:
  #- jcagenchangelog -i ./changelog.txt -o ./$DESTDIR/usr/share/doc/${PACKAGE_NAME}/changelog.Debian -p ${PACKAGE_NAME}
  - mv build/lib/libFields2Cover.so ${DESTDIR}/usr/lib/libjcaFields2Cover.so
  - cp -r include/* ${DESTDIR}/usr/include/jca-fields2cover/

POST_BUILD_REPO: []
#  - gzip -9 -n ./$DESTDIR/usr/share/doc/${PACKAGE_NAME}/changelog.Debian

# Build the files that go inside the repo
PRE_BUILD_FILES: []
BUILD_FILES:
  - docker build -f Dockerfile-build . -t jca-fields2cover:$JOB_NAME
  - docker run -v $PWD:/workspace/fields2cover -entrypoint /workspace/fields2cover/build_in_docker jca-fields2cover:$JOB_NAME
POST_BUILD_FILES: []

# Clean Workspace
CLEAN_REPO:
  - rm -rf ${DESTDIR}